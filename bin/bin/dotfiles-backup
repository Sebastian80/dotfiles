#!/bin/bash
# dotfiles-backup - Quick backup of dotfiles to timestamped directory
# Usage: dotfiles-backup [destination]

set -e

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

info() { echo -e "${GREEN}[INFO]${NC} $1"; }
warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }

DOTFILES_DIR="$HOME/dotfiles"
BACKUP_DIR="${1:-$HOME/dotfiles-backup-$(date +%Y%m%d-%H%M%S)}"

if [[ ! -d "$DOTFILES_DIR" ]]; then
    echo "Error: Dotfiles directory not found at $DOTFILES_DIR"
    exit 1
fi

info "Creating backup at: $BACKUP_DIR"
mkdir -p "$BACKUP_DIR"

# Backup dotfiles repository
info "Backing up dotfiles repository..."
cp -r "$DOTFILES_DIR" "$BACKUP_DIR/"

# Backup important configs not in dotfiles
if [[ -f ~/.ssh/config ]]; then
    info "Backing up SSH config..."
    mkdir -p "$BACKUP_DIR/.ssh"
    cp ~/.ssh/config "$BACKUP_DIR/.ssh/" 2>/dev/null || true
fi

if [[ -d ~/.gnupg ]]; then
    info "Backing up GPG config (not keys)..."
    mkdir -p "$BACKUP_DIR/.gnupg"
    cp ~/.gnupg/*.conf "$BACKUP_DIR/.gnupg/" 2>/dev/null || true
fi

info "âœ“ Backup complete!"
echo "Location: $BACKUP_DIR"
echo "Size: $(du -sh "$BACKUP_DIR" | cut -f1)"
